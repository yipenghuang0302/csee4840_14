\subsection{Custom Functional Units}
In this section we describe the building blocks of the accelerator---our custom functional units---which we assemble to create the submodules described in previous sections. These custom functional units are assembled from IP designs generated by Altera MegaFunctions.

\subsubsection{21-Bit Fixed Point Sine and Cosine}
We use a quartic curve (a fourth degree polynomial of the input angle) to approximate the sine and cosine functions for input values of $-pi$ to $pi$. An example software code for such an approximation can be found at \cite{ref:sincos}. 

Within the sine cosine estimation, intermediate values do not get very large, so a narrow dynamic range for the variables is acceptable. On the other hand, we need high precision so minimal numerical errors are introduced into the rest of the algorithm. We decided on using a 21-bit estimator, with 16-bits of fractional values (right of the decimal point).

\subsubsection{4x4 Matrix-Matrix Multiplication}
The full transformation matrix pipeline needs to multiply D-H transformation blocks. Instead of instantiating a costly, dedicated 4x4 matrix multiplication functional unit, we use the 6x6 matrix multiplication functional unit needed for the damped least squared algorithm, which would otherwise be idle while the accelerator is finding the Jacobian matrix.

When using the 6x6 matrix multiplier for multiplying 4x4 matrices, the additional pair of rows and columns that pad the 4x4 matrices will be zero.

\subsubsection{6x6 Matrix-Matrix Multiplication}
Matrix-matrix multiplication is highly parallel---multiplying 6x6 matrices requires $6^3$ multiplications that may occur in parallel. We cannot instantiate 216 multipliers on the FPGA, so instead we will do 36 multiplies at once and accumulate the products for the result. These multipliers are pipelined so a new multiplication is always in flight.

\subsubsection{27-Bit Fixed Point Multipliers}
In all, we instantiated 59 multipliers in the design. Eight of them go to finding the second and fourth power of $theta$ and $alpha$ joint angles for both the sine and cosine pipelines. 36 of them are arranged for matrix multiplication, which can also be repurposed as parallel multipliers, useful for array-matrix multiplication and cross products. 15 of the multipliers are for low-latency parallel multiplications needed in matrix inversion.

We explored using higher bit precision multipliers so the accelerator could operate on a larger range of input values. However, the digital signal processors on the Cyclone V FPGA have a natural bitwidth of 27-bit. More precise multipliers would incur an immense area cost.